{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport axios from \"axios\";\nimport { setStepperSteps, setEndpoint, setBaseUrl, setEndorsement, setSealSession } from \"../../../store\";\nimport Layout from \"../../../components/Layout\";\nimport { connect } from \"react-redux\";\nimport { Button, Row, Col, Card, Container } from \"react-bootstrap\";\nimport MyStepper from \"../../../components/Stepper\";\nimport HomeButton from \"../../../components/HomeButton\";\nimport IssueVCButton from \"../../../components/IssueVCButton\";\nimport PairOrCard from \"../../../components/PairOrCard\";\nimport EndorsedEBillForm from \"../../../components/endorserEBillForm\";\n\nvar AuthorizeEbill = /*#__PURE__*/function (_React$Component) {\n  _inherits(AuthorizeEbill, _React$Component);\n\n  var _super = _createSuper(AuthorizeEbill);\n\n  function AuthorizeEbill(props) {\n    var _this;\n\n    _classCallCheck(this, AuthorizeEbill);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"submit\", function (values) {\n      // console.log(\"authorize-ebill values\")\n      // console.log(values);\n      // console.log(`the session is ${this.props.sealSession}`)\n      var verificationId = values.verification; // console.log(``)\n      // values.source = \"ebill\";\n      // let toSelect = [values];\n      // this.props.setSefToSelection(toSelect);\n\n      var uri = \"/endorse/ebill/authorization?verification=\".concat(verificationId, \"&session=\").concat(_this.props.sealSession);\n      axios.get(uri).then(function (data) {\n        _this.setState({\n          vcSent: true\n        });\n      })[\"catch\"](function (error) {\n        console.log(error);\n\n        _this.setState({\n          error: true\n        });\n      });\n    });\n\n    _this.dispatch = props.dispatch;\n    _this.isFetching = props.isFetching;\n    _this.sessionData = props.sessionData;\n    _this.hasRequiredAttributes = props.sessionData !== null && props.sessionData !== undefined && props.sessionData.ebill !== undefined;\n    _this.state = {\n      error: null,\n      vcSent: false\n    };\n    return _this;\n  }\n\n  _createClass(AuthorizeEbill, [{\n    key: \"render\",\n    value: function render() {\n      var stepNumber = 0;\n      var stepperSteps = [{\n        title: \"Επιβεβαιώστε τα κάτωθι στοιχεία\"\n      } // { title: \"Declare Self Attested Attributes\" },\n      ];\n\n      var issueVCBut = __jsx(IssueVCButton, {\n        hasRequiredAttributes: this.props.sessionData !== null && this.props.sessionData !== undefined && this.props.sessionData.ebill !== undefined,\n        baseUrl: this.props.baseUrl,\n        userSelection: this.props.userSelection,\n        uuid: this.props.sealSession,\n        vcType: \"EBILL\"\n      });\n\n      var theCard = __jsx(Card, {\n        className: \"text-center\",\n        style: {\n          marginTop: \"2rem\"\n        }\n      }, __jsx(Card.Header, null, \"\\u0395\\u03C0\\u03B9\\u03B2\\u03B1\\u03B9\\u03B2\\u03AD\\u03C9\\u03C3\\u03B7 \\u03C3\\u03C4\\u03BF\\u03B9\\u03C7\\u03B5\\u03AF\\u03C9\\u03BD \\u03B3\\u03B9\\u03B1 \\u03AD\\u03BA\\u03B4\\u03BF\\u03C3\\u03B7 \\u03A0\\u03B9\\u03C3\\u03C4\\u03BF\\u03C0\\u03BF\\u03B9\\u03B7\\u03C4\\u03B9\\u03BA\\u03BF\\u03CD\"), __jsx(Card.Body, null, __jsx(Card.Title, null, this.hasRequiredAttributes ? \"Credentials Issuance is ready!\" : \"Please authenticate to the required data sources\"), __jsx(Card.Text, null, \"\\u039F\\u03BB\\u03BF\\u03BA\\u03BB\\u03B7\\u03C1\\u03CE\\u03C3\\u03B1\\u03C4\\u03B5 \\u03C4\\u03B7\\u03BD \\u03B1\\u03AF\\u03C4\\u03B7\\u03C3\\u03B7 \\u03B5\\u03C0\\u03B9\\u03B2\\u03B1\\u03B9\\u03B2\\u03AD\\u03C9\\u03C3\\u03B7\\u03C2 \\u03C4\\u03C9\\u03BD \\u03C3\\u03C4\\u03BF\\u03B9\\u03C7\\u03B5\\u03AF\\u03C9\\u03BD \\u03C0\\u03BF\\u03C5 \\u03B4\\u03B7\\u03BB\\u03CE\\u03C3\\u03B1\\u03C4\\u03B5. \\u039C\\u03CC\\u03BB\\u03B9\\u03C2, \\u03C4\\u03B1 \\u03C3\\u03C4\\u03BF\\u03B9\\u03C7\\u03B5\\u03AF\\u03B1 \\u03B5\\u03C0\\u03B9\\u03B2\\u03B5\\u03B2\\u03B1\\u03B9\\u03C9\\u03B8\\u03BF\\u03CD\\u03BD \\u03B1\\u03C0\\u03CC \\u03C4\\u03BF\\u03BD \\u03B1\\u03C1\\u03BC\\u03CC\\u03B4\\u03B9\\u03BF \\u03C6\\u03BF\\u03C1\\u03AD\\u03B1, \\u03CC\\u03C0\\u03C9\\u03C2 \\u03B5\\u03C3\\u03B5\\u03AF\\u03C2 \\u03C4\\u03BF\\u03BD \\u03B4\\u03B7\\u03BB\\u03CE\\u03C3\\u03B1\\u03C4\\u03B5, \\u03C4\\u03BF \\u03B1\\u03BD\\u03C4\\u03AF\\u03C3\\u03C4\\u03BF\\u03B9\\u03C7\\u03BF \\u03C0\\u03B9\\u03C3\\u03C4\\u03BF\\u03C0\\u03BF\\u03B9\\u03B7\\u03C4\\u03B9\\u03BA\\u03CC (Verifiable Credential) \\u03B8\\u03B1 \\u03C3\\u03C4\\u03B1\\u03BB\\u03B5\\u03AF \\u03C3\\u03C4\\u03BF \\u03BA\\u03B9\\u03BD\\u03B7\\u03C4\\u03CC \\u03C3\\u03B1\\u03C2.\"), __jsx(Container, null)));\n\n      var result = this.state.error ? __jsx(\"div\", {\n        style: {\n          marginTop: \"3rem\"\n        }\n      }, \"\\u0397 \\u03C5\\u03C0\\u03B5\\u03CD\\u03B8\\u03C5\\u03BD\\u03B7 \\u03B4\\u03AE\\u03BB\\u03C9\\u03C3\\u03B7 \\u03C0\\u03BF\\u03C5 \\u03C0\\u03B1\\u03C1\\u03B5\\u03AF\\u03C7\\u03B1\\u03C4\\u03B5 \\u03B4\\u03B5\\u03BD \\u03C0\\u03B9\\u03C3\\u03C4\\u03BF\\u03C0\\u03BF\\u03B9\\u03B5\\u03AF \\u03C4\\u03B9\\u03C2 \\u03B6\\u03B7\\u03C4\\u03BF\\u03CD\\u03BC\\u03B5\\u03BD\\u03B5\\u03C2 \\u03B4\\u03B9\\u03B1\\u03C0\\u03B9\\u03C3\\u03C4\\u03B5\\u03CD\\u03C3\\u03B5\\u03B9\\u03C2\") : this.state.vcSent ? __jsx(\"div\", {\n        style: {\n          marginTop: \"3rem\"\n        }\n      }, \"\\u03A4\\u03BF \\u03B4\\u03B9\\u03B1\\u03C0\\u03B9\\u03C3\\u03C4\\u03B5\\u03C5\\u03C4\\u03AE\\u03C1\\u03B9\\u03BF\\u03BD \\u03AD\\u03C7\\u03B5\\u03B9 \\u03B1\\u03C0\\u03BF\\u03C3\\u03C4\\u03B1\\u03BB\\u03B5\\u03AF \\u03C3\\u03C4\\u03BF \\u03BA\\u03B9\\u03BD\\u03B7\\u03C4\\u03CC \\u03C4\\u03BF\\u03C5 \\u03C7\\u03C1\\u03AE\\u03C3\\u03C4\\u03B7 \\u03BC\\u03B5 \\u03B5\\u03C0\\u03B9\\u03C4\\u03C5\\u03C7\\u03AF\\u03B1\") : __jsx(PairOrCard, {\n        qrData: this.props.qrData,\n        DID: this.props.DID,\n        baseUrl: this.props.baseUrl,\n        uuid: this.props.uuid,\n        serverSessionId: this.props.sealSession,\n        card: theCard,\n        vcSent: this.props.vcSent,\n        sealSession: this.props.sealSession,\n        formDataUploaded: this.props.sessionData !== null && this.props.sessionData !== undefined && this.props.sessionData.ebill !== undefined,\n        selfForm: __jsx(EndorsedEBillForm, {\n          onSubmit: this.submit,\n          endorsed: this.props.endorsement\n        })\n      });\n      return __jsx(Layout, null, __jsx(Row, null, __jsx(Col, null, __jsx(MyStepper, {\n        steps: stepperSteps,\n        activeNum: stepNumber\n      }))), result, __jsx(Row, null, __jsx(HomeButton, {\n        baseUrl: this.props.baseUrl\n      })));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n        var reduxStore, req, endorsement, sealSession, baseUrl;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                reduxStore = _ref.reduxStore, req = _ref.req;\n\n                if (false) {\n                  endorsement = req.session.endorsement;\n                  reduxStore.dispatch(setEndorsement(req.session.endorsement));\n                  reduxStore.dispatch(setEndpoint(req.session.enpoint));\n                  baseUrl = req.session.baseUrl ? \"/\".concat(req.session.baseUrl, \"/\") : \"\";\n                  reduxStore.dispatch(setBaseUrl(baseUrl));\n                  sealSession = req.session.sessionId;\n                  reduxStore.dispatch(setSealSession(sealSession));\n                } else {\n                  endorsement = reduxStore.getState().endorsement;\n                  sealSession = reduxStore.getState().sealSession;\n                } //this way the userSessionData gets set in all settings\n\n\n                if (endorsement) {\n                  reduxStore.dispatch(setEndorsement(endorsement));\n                } //returned value here is getting mered with the mapstatetoprops\n                // mapstatetoprops overrides these values if they match\n\n\n                return _context.abrupt(\"return\", {\n                  endorsement: endorsement,\n                  sealSession: reduxStore.getState().sealSession // error: null,\n\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }() // componentDidMount() {\n    //   if (!this.props.DID) {\n    //     //if DID auth has not been completed\n    //     if (!this.props.sealSession) {\n    //       this.props.startSessionAndDidAuth(this.props.baseUrl, isMobile()); //and then makeConnectionRequest\n    //     } else {\n    //       this.props.makeConnectionRequest(\n    //         this.props.sealSession,\n    //         this.props.baseUrl,\n    //         isMobile()\n    //       );\n    //     }\n    //   }\n    // }\n\n  }]);\n\n  return AuthorizeEbill;\n}(React.Component);\n\nfunction mapStateToProps(state) {\n  return {\n    sessionData: state.appReducer.sessionData,\n    DID: true,\n    sealSession: state.appReducer.sealSession\n  };\n}\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setSteps: function setSteps(steps) {\n      dispatch(setStepperSteps(steps));\n    },\n    setEndPoint: function setEndPoint(endpont) {\n      dispatch(setEndpoint(endpoint));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AuthorizeEbill);","map":{"version":3,"sources":["/home/ni/code/js/sbchain-issuer/pages/endorse/issue/authorize-ebill.js"],"names":["React","axios","setStepperSteps","setEndpoint","setBaseUrl","setEndorsement","setSealSession","Layout","connect","Button","Row","Col","Card","Container","MyStepper","HomeButton","IssueVCButton","PairOrCard","EndorsedEBillForm","AuthorizeEbill","props","values","verificationId","verification","uri","sealSession","get","then","data","setState","vcSent","error","console","log","dispatch","isFetching","sessionData","hasRequiredAttributes","undefined","ebill","state","stepNumber","stepperSteps","title","issueVCBut","baseUrl","userSelection","theCard","marginTop","result","qrData","DID","uuid","submit","endorsement","reduxStore","req","session","enpoint","sessionId","getState","Component","mapStateToProps","appReducer","mapDispatchToProps","setSteps","steps","setEndPoint","endpont","endpoint"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport axios from \"axios\";\n\nimport {\n  setStepperSteps,\n  setEndpoint,\n  setBaseUrl,\n  setEndorsement,\n  setSealSession,\n} from \"../../../store\";\nimport Layout from \"../../../components/Layout\";\nimport { connect } from \"react-redux\";\nimport { Button, Row, Col, Card, Container } from \"react-bootstrap\";\nimport MyStepper from \"../../../components/Stepper\";\nimport HomeButton from \"../../../components/HomeButton\";\nimport IssueVCButton from \"../../../components/IssueVCButton\";\nimport PairOrCard from \"../../../components/PairOrCard\";\nimport EndorsedEBillForm from \"../../../components/endorserEBillForm\";\n\nclass AuthorizeEbill extends React.Component {\n  constructor(props) {\n    super(props);\n    this.dispatch = props.dispatch;\n    this.isFetching = props.isFetching;\n    this.sessionData = props.sessionData;\n    this.hasRequiredAttributes =\n      props.sessionData !== null &&\n      props.sessionData !== undefined &&\n      props.sessionData.ebill !== undefined;\n\n    this.state = { error: null, vcSent:false };\n  }\n\n  static async getInitialProps({ reduxStore, req }) {\n    let endorsement;\n    let sealSession;\n    if (typeof window === \"undefined\") {\n      endorsement = req.session.endorsement;\n      reduxStore.dispatch(setEndorsement(req.session.endorsement));\n      reduxStore.dispatch(setEndpoint(req.session.enpoint));\n      let baseUrl = req.session.baseUrl ? `/${req.session.baseUrl}/` : \"\";\n      reduxStore.dispatch(setBaseUrl(baseUrl));\n      sealSession = req.session.sessionId;\n      reduxStore.dispatch(setSealSession(sealSession));\n    } else {\n      endorsement = reduxStore.getState().endorsement;\n      sealSession = reduxStore.getState().sealSession;\n    }\n\n    //this way the userSessionData gets set in all settings\n    if (endorsement) {\n      reduxStore.dispatch(setEndorsement(endorsement));\n    }\n\n    //returned value here is getting mered with the mapstatetoprops\n    // mapstatetoprops overrides these values if they match\n    return {\n      endorsement: endorsement,\n      sealSession: reduxStore.getState().sealSession,\n      // error: null,\n    };\n  }\n\n  // componentDidMount() {\n  //   if (!this.props.DID) {\n  //     //if DID auth has not been completed\n  //     if (!this.props.sealSession) {\n  //       this.props.startSessionAndDidAuth(this.props.baseUrl, isMobile()); //and then makeConnectionRequest\n  //     } else {\n  //       this.props.makeConnectionRequest(\n  //         this.props.sealSession,\n  //         this.props.baseUrl,\n  //         isMobile()\n  //       );\n  //     }\n  //   }\n  // }\n\n  submit = (values) => {\n    // console.log(\"authorize-ebill values\")\n    // console.log(values);\n    // console.log(`the session is ${this.props.sealSession}`)\n    let verificationId = values.verification;\n    // console.log(``)\n    // values.source = \"ebill\";\n    // let toSelect = [values];\n    // this.props.setSefToSelection(toSelect);\n    let uri = `/endorse/ebill/authorization?verification=${verificationId}&session=${this.props.sealSession}`;\n    axios\n      .get(uri)\n      .then((data) => {\n         this.setState({\n          vcSent:true\n        });\n      })\n      .catch((error) => {\n        console.log(error);\n        this.setState({\n          error: true,\n        });\n      });\n  };\n\n  render() {\n    let stepNumber = 0;\n    let stepperSteps = [\n      { title: \"Επιβεβαιώστε τα κάτωθι στοιχεία\" },\n      // { title: \"Declare Self Attested Attributes\" },\n    ];\n\n    let issueVCBut = (\n      <IssueVCButton\n        hasRequiredAttributes={\n          this.props.sessionData !== null &&\n          this.props.sessionData !== undefined &&\n          this.props.sessionData.ebill !== undefined\n        }\n        baseUrl={this.props.baseUrl}\n        userSelection={this.props.userSelection}\n        uuid={this.props.sealSession}\n        vcType={\"EBILL\"}\n      />\n    );\n\n    let theCard = (\n      <Card className=\"text-center\" style={{ marginTop: \"2rem\" }}>\n        <Card.Header>\n          Επιβαιβέωση στοιχείων για έκδοση Πιστοποιητικού\n        </Card.Header>\n        <Card.Body>\n          <Card.Title>\n            {this.hasRequiredAttributes\n              ? \"Credentials Issuance is ready!\"\n              : \"Please authenticate to the required data sources\"}\n          </Card.Title>\n          <Card.Text>\n            Ολοκληρώσατε την αίτηση επιβαιβέωσης των στοιχείων που δηλώσατε.\n            Μόλις, τα στοιχεία επιβεβαιωθούν από τον αρμόδιο φορέα, όπως εσείς\n            τον δηλώσατε, το αντίστοιχο πιστοποιητικό (Verifiable Credential) θα\n            σταλεί στο κινητό σας.\n          </Card.Text>\n          <Container>\n            {/* <Row>\n              <Col>{issueVCBut}</Col>\n            </Row> */}\n          </Container>\n        </Card.Body>\n      </Card>\n    );\n\n    let result = this.state.error ? (\n      <div style={{marginTop:\"3rem\"}}>\n        Η υπεύθυνη δήλωση που παρείχατε δεν πιστοποιεί τις ζητούμενες\n        διαπιστεύσεις\n      </div>\n    ) : \n      this.state.vcSent? (\n        <div style={{marginTop:\"3rem\"}}>\n          Το διαπιστευτήριον έχει αποσταλεί στο κινητό του χρήστη με επιτυχία\n        </div>\n      ):\n    \n    (\n      <PairOrCard\n        qrData={this.props.qrData}\n        DID={this.props.DID}\n        baseUrl={this.props.baseUrl}\n        uuid={this.props.uuid}\n        serverSessionId={this.props.sealSession}\n        card={theCard}\n        vcSent={this.props.vcSent}\n        sealSession={this.props.sealSession}\n        formDataUploaded={\n          this.props.sessionData !== null &&\n          this.props.sessionData !== undefined &&\n          this.props.sessionData.ebill !== undefined\n        }\n        selfForm={\n          <EndorsedEBillForm\n            onSubmit={this.submit}\n            endorsed={this.props.endorsement}\n          />\n        }\n      />\n    );\n\n    return (\n      <Layout>\n        <Row>\n          <Col>\n            <MyStepper steps={stepperSteps} activeNum={stepNumber} />\n          </Col>\n        </Row>\n        {result}\n\n        <Row>\n          <HomeButton baseUrl={this.props.baseUrl} />\n        </Row>\n      </Layout>\n    );\n  }\n}\nfunction mapStateToProps(state) {\n  return {\n    sessionData: state.appReducer.sessionData,\n    DID: true,\n    sealSession: state.appReducer.sealSession,\n  };\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setSteps: (steps) => {\n      dispatch(setStepperSteps(steps));\n    },\n    setEndPoint: (endpont) => {\n      dispatch(setEndpoint(endpoint));\n    },\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AuthorizeEbill);\n"]},"metadata":{},"sourceType":"module"}