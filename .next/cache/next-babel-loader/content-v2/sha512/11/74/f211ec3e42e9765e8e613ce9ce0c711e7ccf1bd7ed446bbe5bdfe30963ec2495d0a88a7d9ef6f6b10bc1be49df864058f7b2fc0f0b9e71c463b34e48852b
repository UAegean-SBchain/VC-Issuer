{"ast":null,"code":"import _regeneratorRuntime from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport axios from \"axios\";\nimport { setStepperSteps, setEndpoint, setBaseUrl, setEndorsement, setSealSession } from \"../../../store\";\nimport Layout from \"../../../components/Layout\";\nimport { connect } from \"react-redux\";\nimport { Button, Row, Col, Card, Container } from \"react-bootstrap\";\nimport MyStepper from \"../../../components/Stepper\";\nimport HomeButton from \"../../../components/HomeButton\";\nimport IssueVCButton from \"../../../components/IssueVCButton\";\nimport PairOrCard from \"../../../components/PairOrCard\";\nimport EndorsedEBillForm from \"../../../components/endorserEBillForm\";\n\nvar AuthorizeEbill = /*#__PURE__*/function (_React$Component) {\n  _inherits(AuthorizeEbill, _React$Component);\n\n  var _super = _createSuper(AuthorizeEbill);\n\n  function AuthorizeEbill(props) {\n    var _this;\n\n    _classCallCheck(this, AuthorizeEbill);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"submit\", function (values) {\n      // console.log(\"authorize-ebill values\")\n      // console.log(values);\n      // console.log(`the session is ${this.props.sealSession}`)\n      var verificationId = values.verification; // console.log(``)\n      // values.source = \"ebill\";\n      // let toSelect = [values];\n      // this.props.setSefToSelection(toSelect);\n\n      var uri = \"/endorse/ebill/authorization?verification=\".concat(verificationId, \"&session=\").concat(_this.props.sealSession);\n      axios.get(uri).then(function (data) {\n        _this.setState({\n          vcSent: true\n        });\n      })[\"catch\"](function (error) {\n        console.log(error);\n\n        _this.setState({\n          error: true\n        });\n      });\n    });\n\n    _this.dispatch = props.dispatch;\n    _this.isFetching = props.isFetching;\n    _this.sessionData = props.sessionData;\n    _this.hasRequiredAttributes = props.sessionData !== null && props.sessionData !== undefined && props.sessionData.ebill !== undefined;\n    _this.state = {\n      error: null,\n      vcSent: false\n    };\n    return _this;\n  }\n\n  _createClass(AuthorizeEbill, [{\n    key: \"render\",\n    value: function render() {\n      var stepNumber = 0;\n      var stepperSteps = [{\n        title: \"Επιβεβαιώστε τα κάτωθι στοιχεία\"\n      } // { title: \"Declare Self Attested Attributes\" },\n      ];\n\n      var issueVCBut = __jsx(IssueVCButton, {\n        hasRequiredAttributes: this.props.sessionData !== null && this.props.sessionData !== undefined && this.props.sessionData.ebill !== undefined,\n        baseUrl: this.props.baseUrl,\n        userSelection: this.props.userSelection,\n        uuid: this.props.sealSession,\n        vcType: \"EBILL\"\n      });\n\n      var theCard = __jsx(Card, {\n        className: \"text-center\",\n        style: {\n          marginTop: \"2rem\"\n        }\n      }, __jsx(Card.Header, null, \"\\u0395\\u03C0\\u03B9\\u03B2\\u03B1\\u03B9\\u03B2\\u03AD\\u03C9\\u03C3\\u03B7 \\u03C3\\u03C4\\u03BF\\u03B9\\u03C7\\u03B5\\u03AF\\u03C9\\u03BD \\u03B3\\u03B9\\u03B1 \\u03AD\\u03BA\\u03B4\\u03BF\\u03C3\\u03B7 \\u03A0\\u03B9\\u03C3\\u03C4\\u03BF\\u03C0\\u03BF\\u03B9\\u03B7\\u03C4\\u03B9\\u03BA\\u03BF\\u03CD\"), __jsx(Card.Body, null, __jsx(Card.Title, null, this.hasRequiredAttributes ? \"Credentials Issuance is ready!\" : \"Please authenticate to the required data sources\"), __jsx(Card.Text, null, \"\\u039F\\u03BB\\u03BF\\u03BA\\u03BB\\u03B7\\u03C1\\u03CE\\u03C3\\u03B1\\u03C4\\u03B5 \\u03C4\\u03B7\\u03BD \\u03B1\\u03AF\\u03C4\\u03B7\\u03C3\\u03B7 \\u03B5\\u03C0\\u03B9\\u03B2\\u03B1\\u03B9\\u03B2\\u03AD\\u03C9\\u03C3\\u03B7\\u03C2 \\u03C4\\u03C9\\u03BD \\u03C3\\u03C4\\u03BF\\u03B9\\u03C7\\u03B5\\u03AF\\u03C9\\u03BD \\u03C0\\u03BF\\u03C5 \\u03B4\\u03B7\\u03BB\\u03CE\\u03C3\\u03B1\\u03C4\\u03B5. \\u039C\\u03CC\\u03BB\\u03B9\\u03C2, \\u03C4\\u03B1 \\u03C3\\u03C4\\u03BF\\u03B9\\u03C7\\u03B5\\u03AF\\u03B1 \\u03B5\\u03C0\\u03B9\\u03B2\\u03B5\\u03B2\\u03B1\\u03B9\\u03C9\\u03B8\\u03BF\\u03CD\\u03BD \\u03B1\\u03C0\\u03CC \\u03C4\\u03BF\\u03BD \\u03B1\\u03C1\\u03BC\\u03CC\\u03B4\\u03B9\\u03BF \\u03C6\\u03BF\\u03C1\\u03AD\\u03B1, \\u03CC\\u03C0\\u03C9\\u03C2 \\u03B5\\u03C3\\u03B5\\u03AF\\u03C2 \\u03C4\\u03BF\\u03BD \\u03B4\\u03B7\\u03BB\\u03CE\\u03C3\\u03B1\\u03C4\\u03B5, \\u03C4\\u03BF \\u03B1\\u03BD\\u03C4\\u03AF\\u03C3\\u03C4\\u03BF\\u03B9\\u03C7\\u03BF \\u03C0\\u03B9\\u03C3\\u03C4\\u03BF\\u03C0\\u03BF\\u03B9\\u03B7\\u03C4\\u03B9\\u03BA\\u03CC (Verifiable Credential) \\u03B8\\u03B1 \\u03C3\\u03C4\\u03B1\\u03BB\\u03B5\\u03AF \\u03C3\\u03C4\\u03BF \\u03BA\\u03B9\\u03BD\\u03B7\\u03C4\\u03CC \\u03C3\\u03B1\\u03C2.\"), __jsx(Container, null)));\n\n      var result = this.state.error ? __jsx(\"div\", {\n        style: {\n          marginTop: \"3rem\"\n        }\n      }, \"\\u0397 \\u03C5\\u03C0\\u03B5\\u03CD\\u03B8\\u03C5\\u03BD\\u03B7 \\u03B4\\u03AE\\u03BB\\u03C9\\u03C3\\u03B7 \\u03C0\\u03BF\\u03C5 \\u03C0\\u03B1\\u03C1\\u03B5\\u03AF\\u03C7\\u03B1\\u03C4\\u03B5 \\u03B4\\u03B5\\u03BD \\u03C0\\u03B9\\u03C3\\u03C4\\u03BF\\u03C0\\u03BF\\u03B9\\u03B5\\u03AF \\u03C4\\u03B9\\u03C2 \\u03B6\\u03B7\\u03C4\\u03BF\\u03CD\\u03BC\\u03B5\\u03BD\\u03B5\\u03C2 \\u03B4\\u03B9\\u03B1\\u03C0\\u03B9\\u03C3\\u03C4\\u03B5\\u03CD\\u03C3\\u03B5\\u03B9\\u03C2\") : this.state.vcSent ? __jsx(\"div\", {\n        style: {\n          marginTop: \"3rem\"\n        }\n      }, \"\\u03A4\\u03BF \\u03B4\\u03B9\\u03B1\\u03C0\\u03B9\\u03C3\\u03C4\\u03B5\\u03C5\\u03C4\\u03AE\\u03C1\\u03B9\\u03BF\\u03BD \\u03AD\\u03C7\\u03B5\\u03B9 \\u03B1\\u03C0\\u03BF\\u03C3\\u03C4\\u03B1\\u03BB\\u03B5\\u03AF \\u03C3\\u03C4\\u03BF \\u03BA\\u03B9\\u03BD\\u03B7\\u03C4\\u03CC \\u03C4\\u03BF\\u03C5 \\u03C7\\u03C1\\u03AE\\u03C3\\u03C4\\u03B7 \\u03BC\\u03B5 \\u03B5\\u03C0\\u03B9\\u03C4\\u03C5\\u03C7\\u03AF\\u03B1\") : __jsx(PairOrCard, {\n        qrData: this.props.qrData,\n        DID: this.props.DID,\n        baseUrl: this.props.baseUrl,\n        uuid: this.props.uuid,\n        serverSessionId: this.props.sealSession,\n        card: theCard,\n        vcSent: this.props.vcSent,\n        sealSession: this.props.sealSession,\n        formDataUploaded: this.props.sessionData !== null && this.props.sessionData !== undefined && this.props.sessionData.ebill !== undefined,\n        selfForm: __jsx(EndorsedEBillForm, {\n          onSubmit: this.submit,\n          endorsed: this.props.endorsement\n        })\n      });\n      return __jsx(Layout, null, __jsx(Row, null, __jsx(Col, null, __jsx(MyStepper, {\n        steps: stepperSteps,\n        activeNum: stepNumber\n      }))), result, __jsx(Row, null, __jsx(HomeButton, {\n        baseUrl: this.props.baseUrl\n      })));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n        var reduxStore, req, endorsement, sealSession, baseUrl;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                reduxStore = _ref.reduxStore, req = _ref.req;\n\n                if (false) {\n                  endorsement = req.session.endorsement;\n                  reduxStore.dispatch(setEndorsement(req.session.endorsement));\n                  reduxStore.dispatch(setEndpoint(req.session.enpoint));\n                  baseUrl = req.session.baseUrl ? \"/\".concat(req.session.baseUrl, \"/\") : \"\";\n                  reduxStore.dispatch(setBaseUrl(baseUrl));\n                  sealSession = req.session.sessionId;\n                  reduxStore.dispatch(setSealSession(sealSession));\n                } else {\n                  endorsement = reduxStore.getState().endorsement;\n                  sealSession = reduxStore.getState().sealSession;\n                } //this way the userSessionData gets set in all settings\n\n\n                if (endorsement) {\n                  reduxStore.dispatch(setEndorsement(endorsement));\n                } //returned value here is getting mered with the mapstatetoprops\n                // mapstatetoprops overrides these values if they match\n\n\n                return _context.abrupt(\"return\", {\n                  endorsement: endorsement,\n                  sealSession: reduxStore.getState().sealSession // error: null,\n\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }() // componentDidMount() {\n    //   if (!this.props.DID) {\n    //     //if DID auth has not been completed\n    //     if (!this.props.sealSession) {\n    //       this.props.startSessionAndDidAuth(this.props.baseUrl, isMobile()); //and then makeConnectionRequest\n    //     } else {\n    //       this.props.makeConnectionRequest(\n    //         this.props.sealSession,\n    //         this.props.baseUrl,\n    //         isMobile()\n    //       );\n    //     }\n    //   }\n    // }\n\n  }]);\n\n  return AuthorizeEbill;\n}(React.Component);\n\nfunction mapStateToProps(state) {\n  return {\n    sessionData: state.appReducer.sessionData,\n    DID: true,\n    sealSession: state.appReducer.sealSession\n  };\n}\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setSteps: function setSteps(steps) {\n      dispatch(setStepperSteps(steps));\n    },\n    setEndPoint: function setEndPoint(endpont) {\n      dispatch(setEndpoint(endpoint));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AuthorizeEbill);","map":null,"metadata":{},"sourceType":"module"}