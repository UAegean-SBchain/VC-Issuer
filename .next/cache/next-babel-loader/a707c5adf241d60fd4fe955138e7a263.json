{"ast":null,"code":"import _regeneratorRuntime from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/home/ni/code/js/sbchain-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport axios from \"axios\";\nimport SelForm from \"../../../components/SelForm\";\nimport { setSessionData, makeOnlyConnectionRequest, addSetToSelection, setStepperSteps, setEndpoint, setBaseUrl // setServerSessionId,\n, completeDIDAuth, makeSealSession, makeSessionWithDIDConnecetionRequest, setSealSession, setEidasUriPort, setEidasRedirectUri } from \"../../../store\";\nimport Layout from \"../../../components/Layout\";\nimport { connect } from \"react-redux\";\nimport { Button, Row, Col, Card, Container } from \"react-bootstrap\";\nimport MyStepper from \"../../../components/Stepper\";\nimport HomeButton from \"../../../components/HomeButton\";\nimport IssueVCButton from \"../../../components/IssueVCButton\";\nimport PairOrCard from \"../../../components/PairOrCard\";\nimport isMobile from \"../../../helpers/isMobile\";\nimport ContactDetailsForm from \"../../../components/contactDetailsForm\";\nimport ConnectMobile from \"../../../components/ConnectMobile\";\n\nvar transport = require(\"uport-transports\").transport;\n/*\n  Secure flow:\n  - check in session if DID is present. This is not only the DID of the user but the whole connection response\n  - if it is not present:\n    - first display DID connection request (QR etc.). The DID response endpoint should contain the session here\n    - on response on the server, send a SSE to the front end, denoting that DID auth is completed and on the server there is the DID component\n    - Display additional datasources\n    - on VC issance request, do not display QR code etc, but send the credentials straigth to the users wallet\n\n*/\n\n\nvar IssueContact = /*#__PURE__*/function (_React$Component) {\n  _inherits(IssueContact, _React$Component);\n\n  var _super = _createSuper(IssueContact);\n\n  function IssueContact(props) {\n    var _this;\n\n    _classCallCheck(this, IssueContact);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"submit\", function (values) {\n      console.log(values);\n      values.source = \"contact\";\n      var toSelect = [values];\n\n      _this.props.setSefToSelection(toSelect);\n\n      axios.post(\"../../contact/store\", {\n        session: _this.props.sealSession,\n        details: values\n      }).then(function (data) {\n        console.log(\"updated backend with selection\");\n      }).then(function (response) {\n        _this.props.setContactToSession({\n          contact: values\n        });\n      })[\"catch\"](function (error) {\n        console.log(error);\n      });\n    });\n\n    _this.dispatch = props.dispatch;\n    _this.isFetching = props.isFetching;\n    _this.sessionData = props.sessionData;\n    _this.hasRequiredAttributes = props.sessionData !== null && props.sessionData !== undefined && props.sessionData.contact !== undefined;\n    return _this;\n  }\n\n  _createClass(IssueContact, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // if (this.props.sessionData && this.props.sessionData.contact) {\n      //   let toSelect = [this.props.sessionData.amka];\n      //   this.props.setSefToSelection(toSelect);\n      // }\n      if (!this.props.DID) {\n        //if DID auth has not been completed\n        if (!this.props.sealSession) {\n          this.props.startSessionAndDidAuth(this.props.baseUrl, isMobile()); //and then makeConnectionRequest\n        } else {\n          this.props.makeConnectionRequest(this.props.sealSession, this.props.baseUrl, isMobile());\n        }\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var stepNumber = !this.props.DID ? 0 : this.hasRequiredAttributes ? 2 : 1;\n      var stepperSteps = [{\n        title: \"Pair your wallet\"\n      }, {\n        title: \"Declare Self Attested Attributes\"\n      }, {\n        title: \"Request Issuance\"\n      }];\n\n      if (this.props.qrData && isMobile() && !this.props.DID) {\n        return __jsx(Layout, null, __jsx(Row, null, __jsx(Col, null, __jsx(MyStepper, {\n          steps: stepperSteps,\n          activeNum: stepNumber\n        }))), __jsx(ConnectMobile, {\n          baseUrl: this.props.baseUrl,\n          qrData: this.props.qrData,\n          DID: this.props.DID,\n          uuid: this.props.uuid,\n          serverSessionId: this.props.uuid,\n          sealSession: this.props.uuid\n        }));\n      }\n\n      var issueVCBut = __jsx(IssueVCButton, {\n        hasRequiredAttributes: this.props.sessionData !== null && this.props.sessionData !== undefined && this.props.sessionData.contact !== undefined,\n        baseUrl: this.props.baseUrl,\n        userSelection: this.props.userSelection,\n        uuid: this.props.sealSession,\n        vcType: \"CONTACT-DETAILS\"\n      });\n\n      var selfCard = __jsx(Card, {\n        className: \"text-center\",\n        style: {\n          marginTop: \"2rem\"\n        }\n      }, __jsx(Card.Header, null, \"Issue a Verifiable Credential containing self attested attributes\"), __jsx(Card.Body, null, __jsx(Card.Title, null, this.hasRequiredAttributes ? \"Credentials Issuance is ready!\" : \"Please authenticate to the required data sources\"), __jsx(Card.Text, null, \"You have completed the self attestation of the required attributes, click the \\\"Issue\\\" button to generate and receive your VC .\"), __jsx(Container, null, __jsx(Row, null, __jsx(Col, null, issueVCBut)))));\n\n      var result = __jsx(PairOrCard, {\n        qrData: this.props.qrData,\n        DID: this.props.DID,\n        baseUrl: this.props.baseUrl,\n        uuid: this.props.uuid,\n        serverSessionId: this.props.sealSession,\n        card: selfCard,\n        vcSent: this.props.vcSent,\n        sealSession: this.props.sealSession,\n        formDataUploaded: this.props.sessionData !== null && this.props.sessionData !== undefined && this.props.sessionData.contact !== undefined,\n        selfForm: __jsx(ContactDetailsForm, {\n          onSubmit: this.submit\n        })\n      });\n\n      return __jsx(Layout, null, __jsx(Row, null, __jsx(Col, null, __jsx(MyStepper, {\n        steps: stepperSteps,\n        activeNum: stepNumber\n      }))), result, __jsx(Row, null, __jsx(HomeButton, {\n        baseUrl: this.props.baseUrl\n      })));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n        var reduxStore, req, userSessionData, DIDOk, sealSession, baseUrl;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                reduxStore = _ref.reduxStore, req = _ref.req;\n\n                if (false) {\n                  userSessionData = req.session.userData;\n                  reduxStore.dispatch(setEndpoint(req.session.enpoint));\n                  baseUrl = req.session.baseUrl ? \"/\".concat(req.session.baseUrl, \"/\") : \"\";\n                  reduxStore.dispatch(setBaseUrl(baseUrl)); // reduxStore.dispatch(setServerSessionId(req.session.sealSession));\n\n                  DIDOk = req.session.DID;\n                  sealSession = req.session.sealSession;\n                  console.log(\"self.js:: in the server the seal session is:: \".concat(req.session.sealSession));\n                } else {\n                  if (reduxStore.getState().sessionData) {\n                    userSessionData = reduxStore.getState().sessionData;\n                    DIDOk = reduxStore.getState().DID; //if ther is sessionData then there should be a session as well\n\n                    sealSession = reduxStore.getState().sealSession; // serverSessionId = reduxStore.getState().serverSessionId;\n                  } else {\n                    console.log(\"no server session data found\");\n                  }\n                } //this way the userSessionData gets set in all settings\n\n\n                if (userSessionData) {\n                  reduxStore.dispatch(setSessionData(userSessionData));\n                }\n\n                if (DIDOk) {\n                  reduxStore.dispatch(completeDIDAuth(sealSession));\n                  reduxStore.dispatch(setSealSession(sealSession));\n                } //returned value here is getting mered with the mapstatetoprops\n                // mapstatetoprops overrides these values if they match\n\n\n                return _context.abrupt(\"return\", {\n                  sessionData: userSessionData,\n                  qrData: reduxStore.getState().qrData,\n                  vcSent: false,\n                  sealSession: reduxStore.getState().sealSession\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return IssueContact;\n}(React.Component);\n\nfunction mapStateToProps(state) {\n  return {\n    isFetching: state.appReducer.fetching,\n    qrData: state.appReducer.qrData,\n    sessionData: state.appReducer.sessionData,\n    userSelection: state.appReducer.userSelection,\n    // the attributes selected by the user to be included in a VC,\n    baseUrl: state.appReducer.baseUrl,\n    DID: state.appReducer.DID,\n    // serverSessionId: state.serverSessionId,\n    uuid: state.appReducer.uuid,\n    vcSent: state.appReducer.vcSent,\n    sealSession: state.appReducer.sealSession,\n    eidasUri: state.appReducer.eidasUri,\n    eidasPort: state.appReducer.eidasPort,\n    endpoint: state.appReducer.endpoint,\n    eidasRedirectUri: state.appReducer.eidasRedirectUri\n  };\n}\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setContactToSession: function setContactToSession(userSessionData) {\n      dispatch(setSessionData(userSessionData));\n    },\n    setSefToSelection: function setSefToSelection(set) {\n      dispatch(addSetToSelection(set));\n    },\n    setSteps: function setSteps(steps) {\n      dispatch(setStepperSteps(steps));\n    },\n    setEndPoint: function setEndPoint(endpont) {\n      dispatch(setEndpoint(endpoint));\n    },\n    makeConnectionRequest: function makeConnectionRequest(sealSession, baseUrl, isMobile) {\n      dispatch(makeOnlyConnectionRequest(sealSession, baseUrl, isMobile));\n    },\n    didAuthOK: function didAuthOK(uuid) {\n      dispatch(completeDIDAuth(uuid));\n    },\n    startSealSession: function startSealSession(baseUrl) {\n      dispatch(makeSealSession(baseUrl));\n    },\n    startSessionAndDidAuth: function startSessionAndDidAuth(baseUrl, isMobile) {\n      dispatch(makeSessionWithDIDConnecetionRequest(baseUrl, isMobile));\n    },\n    setTheSealSession: function setTheSealSession(sessionId) {\n      dispatch(setSealSession(sessionId));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(IssueContact);","map":{"version":3,"sources":["/home/ni/code/js/sbchain-issuer/pages/vc/issue/contact.js"],"names":["React","axios","SelForm","setSessionData","makeOnlyConnectionRequest","addSetToSelection","setStepperSteps","setEndpoint","setBaseUrl","completeDIDAuth","makeSealSession","makeSessionWithDIDConnecetionRequest","setSealSession","setEidasUriPort","setEidasRedirectUri","Layout","connect","Button","Row","Col","Card","Container","MyStepper","HomeButton","IssueVCButton","PairOrCard","isMobile","ContactDetailsForm","ConnectMobile","transport","require","IssueContact","props","values","console","log","source","toSelect","setSefToSelection","post","session","sealSession","details","then","data","response","setContactToSession","contact","error","dispatch","isFetching","sessionData","hasRequiredAttributes","undefined","DID","startSessionAndDidAuth","baseUrl","makeConnectionRequest","stepNumber","stepperSteps","title","qrData","uuid","issueVCBut","userSelection","selfCard","marginTop","result","vcSent","submit","reduxStore","req","userSessionData","userData","enpoint","DIDOk","getState","Component","mapStateToProps","state","appReducer","fetching","eidasUri","eidasPort","endpoint","eidasRedirectUri","mapDispatchToProps","set","setSteps","steps","setEndPoint","endpont","didAuthOK","startSealSession","setTheSealSession","sessionId"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport axios from \"axios\";\nimport SelForm from \"../../../components/SelForm\";\n\nimport {\n  setSessionData,\n  makeOnlyConnectionRequest,\n  addSetToSelection,\n  setStepperSteps,\n  setEndpoint,\n  setBaseUrl,\n  // setServerSessionId,\n  completeDIDAuth,\n  makeSealSession,\n  makeSessionWithDIDConnecetionRequest,\n  setSealSession,\n  setEidasUriPort,\n  setEidasRedirectUri,\n} from \"../../../store\";\nimport Layout from \"../../../components/Layout\";\nimport { connect } from \"react-redux\";\nimport { Button, Row, Col, Card, Container } from \"react-bootstrap\";\nimport MyStepper from \"../../../components/Stepper\";\nimport HomeButton from \"../../../components/HomeButton\";\nimport IssueVCButton from \"../../../components/IssueVCButton\";\nimport PairOrCard from \"../../../components/PairOrCard\";\nimport isMobile from \"../../../helpers/isMobile\";\nimport ContactDetailsForm from \"../../../components/contactDetailsForm\";\nimport ConnectMobile from \"../../../components/ConnectMobile\"\n\nconst transport = require(\"uport-transports\").transport;\n/*\n  Secure flow:\n  - check in session if DID is present. This is not only the DID of the user but the whole connection response\n  - if it is not present:\n    - first display DID connection request (QR etc.). The DID response endpoint should contain the session here\n    - on response on the server, send a SSE to the front end, denoting that DID auth is completed and on the server there is the DID component\n    - Display additional datasources\n    - on VC issance request, do not display QR code etc, but send the credentials straigth to the users wallet\n\n*/\n\nclass IssueContact extends React.Component {\n  constructor(props) {\n    super(props);\n    this.dispatch = props.dispatch;\n    this.isFetching = props.isFetching;\n    this.sessionData = props.sessionData;\n    this.hasRequiredAttributes =\n      props.sessionData !== null &&\n      props.sessionData !== undefined &&\n      props.sessionData.contact !== undefined;\n  }\n\n  static async getInitialProps({ reduxStore, req }) {\n    let userSessionData;\n    let DIDOk;\n    let sealSession;\n    if (typeof window === \"undefined\") {\n      userSessionData = req.session.userData;\n      reduxStore.dispatch(setEndpoint(req.session.enpoint));\n      let baseUrl = req.session.baseUrl ? `/${req.session.baseUrl}/` : \"\";\n      reduxStore.dispatch(setBaseUrl(baseUrl));\n      // reduxStore.dispatch(setServerSessionId(req.session.sealSession));\n      DIDOk = req.session.DID;\n      sealSession = req.session.sealSession;\n      console.log(\n        `self.js:: in the server the seal session is:: ${req.session.sealSession}`\n      );\n    } else {\n      if (reduxStore.getState().sessionData) {\n        userSessionData = reduxStore.getState().sessionData;\n        DIDOk = reduxStore.getState().DID;\n        //if ther is sessionData then there should be a session as well\n        sealSession = reduxStore.getState().sealSession;\n        // serverSessionId = reduxStore.getState().serverSessionId;\n      } else {\n        console.log(`no server session data found`);\n      }\n    }\n\n    //this way the userSessionData gets set in all settings\n    if (userSessionData) {\n      reduxStore.dispatch(setSessionData(userSessionData));\n    }\n    if (DIDOk) {\n      reduxStore.dispatch(completeDIDAuth(sealSession));\n      reduxStore.dispatch(setSealSession(sealSession));\n    }\n\n    //returned value here is getting mered with the mapstatetoprops\n    // mapstatetoprops overrides these values if they match\n    return {\n      sessionData: userSessionData,\n      qrData: reduxStore.getState().qrData,\n      vcSent: false,\n      sealSession: reduxStore.getState().sealSession,\n    };\n  }\n\n  componentDidMount() {\n    // if (this.props.sessionData && this.props.sessionData.contact) {\n    //   let toSelect = [this.props.sessionData.amka];\n    //   this.props.setSefToSelection(toSelect);\n    // }\n\n    if (!this.props.DID) {\n      //if DID auth has not been completed\n      if (!this.props.sealSession) {\n        this.props.startSessionAndDidAuth(this.props.baseUrl, isMobile()); //and then makeConnectionRequest\n      } else {\n        this.props.makeConnectionRequest(\n          this.props.sealSession,\n          this.props.baseUrl,\n          isMobile()\n        );\n      }\n    }\n  }\n\n \n  submit = (values) => {\n   \n    console.log(values);\n    values.source = \"contact\";\n    let toSelect = [values];\n    this.props.setSefToSelection(toSelect);\n    axios\n      .post(\"../../contact/store\", {\n        session: this.props.sealSession,\n        details: values,\n      })\n      .then((data) => {\n        console.log(\"updated backend with selection\");\n      })\n      .then((response) => {\n        this.props.setContactToSession({ contact: values });\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  render() {\n    let stepNumber = !this.props.DID ? 0 : this.hasRequiredAttributes ? 2 : 1;\n    let stepperSteps = [\n      { title: \"Pair your wallet\" },\n      { title: \"Declare Self Attested Attributes\" },\n      { title: \"Request Issuance\" },\n    ];\n\n\n    if (this.props.qrData && isMobile() && !this.props.DID) {\n      return (\n        <Layout>\n          <Row>\n            <Col>\n              <MyStepper steps={stepperSteps} activeNum={stepNumber} />\n            </Col>\n          </Row>\n          <ConnectMobile\n            baseUrl={this.props.baseUrl}\n            qrData={this.props.qrData}\n            DID={this.props.DID}\n            uuid={this.props.uuid}\n            serverSessionId={this.props.uuid}\n            sealSession={this.props.uuid}\n          />\n        </Layout>\n      );\n    }\n\n\n    let issueVCBut = (\n      <IssueVCButton\n        hasRequiredAttributes={\n          this.props.sessionData !== null &&\n          this.props.sessionData !== undefined &&\n          this.props.sessionData.contact !== undefined\n        }\n        baseUrl={this.props.baseUrl}\n        userSelection={this.props.userSelection}\n        uuid={this.props.sealSession}\n        vcType={\"CONTACT-DETAILS\"}\n      />\n    );\n\n    let selfCard = (\n      <Card className=\"text-center\" style={{ marginTop: \"2rem\" }}>\n        <Card.Header>\n          Issue a Verifiable Credential containing self attested attributes\n        </Card.Header>\n        <Card.Body>\n          <Card.Title>\n            {this.hasRequiredAttributes\n              ? \"Credentials Issuance is ready!\"\n              : \"Please authenticate to the required data sources\"}\n          </Card.Title>\n          <Card.Text>\n           You have completed the self attestation of the required attributes, click\n            the \"Issue\" button to generate and receive your VC .\n          </Card.Text>\n          <Container>\n            <Row>\n              <Col>{issueVCBut}</Col>\n            </Row>\n          </Container>\n        </Card.Body>\n      </Card>\n    );\n\n\n\n    let result = (\n      <PairOrCard\n        qrData={this.props.qrData}\n        DID={this.props.DID}\n        baseUrl={this.props.baseUrl}\n        uuid={this.props.uuid}\n        serverSessionId={this.props.sealSession}\n        card={selfCard}\n        vcSent={this.props.vcSent}\n        sealSession={this.props.sealSession}\n        formDataUploaded={\n          this.props.sessionData !== null &&\n          this.props.sessionData !== undefined &&\n          this.props.sessionData.contact !== undefined\n        }\n        selfForm={<ContactDetailsForm onSubmit={this.submit} />}\n      />\n    );\n\n    return (\n      <Layout>\n        <Row>\n          <Col>\n            <MyStepper steps={stepperSteps} activeNum={stepNumber} />\n          </Col>\n        </Row>\n        {result}\n\n        <Row>\n          <HomeButton baseUrl={this.props.baseUrl} />\n        </Row>\n      </Layout>\n    );\n  }\n}\nfunction mapStateToProps(state) {\n  return {\n    isFetching: state.appReducer.fetching,\n    qrData: state.appReducer.qrData,\n    sessionData: state.appReducer.sessionData,\n    userSelection: state.appReducer.userSelection, // the attributes selected by the user to be included in a VC,\n    baseUrl: state.appReducer.baseUrl,\n    DID: state.appReducer.DID,\n    // serverSessionId: state.serverSessionId,\n    uuid: state.appReducer.uuid,\n    vcSent: state.appReducer.vcSent,\n    sealSession: state.appReducer.sealSession,\n    eidasUri: state.appReducer.eidasUri,\n    eidasPort: state.appReducer.eidasPort,\n    endpoint: state.appReducer.endpoint,\n    eidasRedirectUri: state.appReducer.eidasRedirectUri,\n  };\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setContactToSession: (userSessionData) => {\n      dispatch(setSessionData(userSessionData));\n    },\n    setSefToSelection: (set) => {\n      dispatch(addSetToSelection(set));\n    },\n    setSteps: (steps) => {\n      dispatch(setStepperSteps(steps));\n    },\n    setEndPoint: (endpont) => {\n      dispatch(setEndpoint(endpoint));\n    },\n    makeConnectionRequest: (sealSession, baseUrl, isMobile) => {\n      dispatch(makeOnlyConnectionRequest(sealSession, baseUrl, isMobile));\n    },\n    didAuthOK: (uuid) => {\n      dispatch(completeDIDAuth(uuid));\n    },\n    startSealSession: (baseUrl) => {\n      dispatch(makeSealSession(baseUrl));\n    },\n    startSessionAndDidAuth: (baseUrl, isMobile) => {\n      dispatch(makeSessionWithDIDConnecetionRequest(baseUrl, isMobile));\n    },\n    setTheSealSession: (sessionId) => {\n      dispatch(setSealSession(sessionId));\n    },\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(IssueContact);\n"]},"metadata":{},"sourceType":"module"}